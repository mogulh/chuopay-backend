# Generated by Django 4.2.10 on 2025-08-30 11:15

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('contributions', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='SchoolLetterhead',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('letterhead_type', models.CharField(choices=[('official', 'Official'), ('department', 'Department'), ('event', 'Event-specific'), ('stamp', 'Digital Stamp')], default='official', max_length=20)),
                ('department', models.CharField(blank=True, max_length=50)),
                ('file', models.FileField(upload_to='letterheads/')),
                ('file_type', models.CharField(blank=True, max_length=10)),
                ('file_size', models.PositiveIntegerField(blank=True, null=True)),
                ('width', models.PositiveIntegerField(blank=True, null=True)),
                ('height', models.PositiveIntegerField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('is_default', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('school', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='letterheads', to='contributions.school')),
                ('uploaded_by', models.ForeignKey(blank=True, limit_choices_to={'role': 'admin'}, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='uploaded_letterheads', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'School Letterhead',
                'verbose_name_plural': 'School Letterheads',
                'db_table': 'school_letterheads',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ParentApprovalPin',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('pin_hash', models.CharField(help_text='Hashed PIN for security', max_length=128)),
                ('salt', models.CharField(help_text='Salt for PIN hashing', max_length=32)),
                ('is_active', models.BooleanField(default=True)),
                ('max_attempts', models.PositiveIntegerField(default=3)),
                ('current_attempts', models.PositiveIntegerField(default=0)),
                ('locked_until', models.DateTimeField(blank=True, null=True)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('usage_count', models.PositiveIntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('parent', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='approval_pin', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Parent Approval PIN',
                'verbose_name_plural': 'Parent Approval PINs',
                'db_table': 'parent_approval_pins',
            },
        ),
        migrations.CreateModel(
            name='EventDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('document_type', models.CharField(choices=[('approval_form', 'Approval Form'), ('consent_form', 'Consent Form'), ('payment_agreement', 'Payment Agreement'), ('liability_waiver', 'Liability Waiver'), ('custom', 'Custom Document')], max_length=20)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('published', 'Published'), ('archived', 'Archived')], default='draft', max_length=20)),
                ('content_template', models.TextField(help_text='Document template with placeholders')),
                ('final_content', models.TextField(blank=True, help_text='Generated document content')),
                ('document_file', models.FileField(blank=True, null=True, upload_to='event_documents/')),
                ('document_hash', models.CharField(blank=True, help_text='File hash for verification', max_length=64)),
                ('admin_signature', models.ImageField(blank=True, null=True, upload_to='admin_signatures/')),
                ('admin_stamp', models.ImageField(blank=True, null=True, upload_to='admin_stamps/')),
                ('admin_signed_at', models.DateTimeField(blank=True, null=True)),
                ('requires_parent_signature', models.BooleanField(default=True)),
                ('requires_admin_signature', models.BooleanField(default=True)),
                ('is_mandatory', models.BooleanField(default=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('admin_signed_by', models.ForeignKey(blank=True, limit_choices_to={'role': 'admin'}, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='signed_documents', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(limit_choices_to={'role__in': ['admin', 'teacher']}, on_delete=django.db.models.deletion.CASCADE, related_name='created_documents', to=settings.AUTH_USER_MODEL)),
                ('event', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='contributions.contributionevent')),
                ('letterhead', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='approvals.schoolletterhead')),
                ('parent_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='child_versions', to='approvals.eventdocument')),
                ('school', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='event_documents', to='contributions.school')),
            ],
            options={
                'verbose_name': 'Event Document',
                'verbose_name_plural': 'Event Documents',
                'db_table': 'event_documents',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EventApproval',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('expired', 'Expired')], default='pending', max_length=20)),
                ('approval_method', models.CharField(choices=[('signature', 'Digital Signature'), ('pin', 'PIN Code'), ('both', 'Signature and PIN')], default='signature', max_length=20)),
                ('signature_image', models.ImageField(blank=True, null=True, upload_to='signatures/')),
                ('signature_data', models.JSONField(blank=True, help_text='Canvas signature data', null=True)),
                ('signature_hash', models.CharField(blank=True, help_text='SHA256 hash of signature for verification', max_length=64)),
                ('approval_pin', models.CharField(blank=True, help_text="Parent's approval PIN", max_length=6)),
                ('pin_used', models.BooleanField(default=False)),
                ('certificate_data', models.JSONField(blank=True, help_text='Digital certificate information', null=True)),
                ('certificate_hash', models.CharField(blank=True, help_text='Certificate verification hash', max_length=64)),
                ('requested_at', models.DateTimeField(auto_now_add=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('approval_notes', models.TextField(blank=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('event', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='approvals', to='contributions.contributionevent')),
                ('parent', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='event_approvals', to=settings.AUTH_USER_MODEL)),
                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='event_approvals', to='contributions.student')),
            ],
            options={
                'verbose_name': 'Event Approval',
                'verbose_name_plural': 'Event Approvals',
                'db_table': 'event_approvals',
                'ordering': ['-created_at'],
                'unique_together': {('event', 'student', 'parent')},
            },
        ),
        migrations.CreateModel(
            name='DocumentSignature',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('signature_type', models.CharField(choices=[('parent', 'Parent Signature'), ('admin', 'Admin Signature'), ('witness', 'Witness Signature')], max_length=20)),
                ('signature_image', models.ImageField(upload_to='document_signatures/')),
                ('signature_data', models.JSONField(blank=True, null=True)),
                ('signature_hash', models.CharField(help_text='Signature verification hash', max_length=64)),
                ('certificate_data', models.JSONField(blank=True, null=True)),
                ('certificate_hash', models.CharField(blank=True, max_length=64)),
                ('signed_at', models.DateTimeField(auto_now_add=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True)),
                ('is_verified', models.BooleanField(default=False)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approval', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='document_signatures', to='approvals.eventapproval')),
                ('document', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='signatures', to='approvals.eventdocument')),
                ('signer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='document_signatures', to=settings.AUTH_USER_MODEL)),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_signatures', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Document Signature',
                'verbose_name_plural': 'Document Signatures',
                'db_table': 'document_signatures',
                'ordering': ['-signed_at'],
            },
        ),
        migrations.CreateModel(
            name='DigitalCertificate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('certificate_type', models.CharField(choices=[('parent', 'Parent Certificate'), ('admin', 'Admin Certificate'), ('system', 'System Certificate')], max_length=20)),
                ('certificate_id', models.CharField(help_text='Unique certificate identifier', max_length=64, unique=True)),
                ('public_key', models.TextField(help_text='Public key for verification')),
                ('private_key_hash', models.CharField(help_text='Hashed private key', max_length=128)),
                ('issued_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField()),
                ('status', models.CharField(choices=[('active', 'Active'), ('expired', 'Expired'), ('revoked', 'Revoked')], default='active', max_length=20)),
                ('usage_count', models.PositiveIntegerField(default=0)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('issued_by', models.ForeignKey(limit_choices_to={'role': 'admin'}, on_delete=django.db.models.deletion.CASCADE, related_name='issued_certificates', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='digital_certificates', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Digital Certificate',
                'verbose_name_plural': 'Digital Certificates',
                'db_table': 'digital_certificates',
                'ordering': ['-issued_at'],
            },
        ),
    ]
